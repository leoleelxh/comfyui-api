app:
  description: 'ComfyUI图片生成服务'
  icon: 🖼️
  icon_background: '#FEF7C3'
  mode: chat
  name: ComfyUI Image Generator
  use_icon_as_answer_icon: false
kind: app
version: 0.1.0
workflow:
  conversation_variables:
  - description: '图片生成提示词'
    id: prompt-var-001
    name: prompt
    selector: []
    value: ''
    value_type: string
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: '欢迎使用ComfyUI图片生成服务！请输入您想要生成的图片描述。'
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
  graph:
    edges:
    - data:
        isInIteration: false
        sourceType: start
        targetType: http_request
      source: start_node
      sourceHandle: source
      target: generate_image
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: http_request
        targetType: http_request
      source: generate_image
      sourceHandle: source
      target: check_status
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: http_request
        targetType: http_request
      source: check_status
      sourceHandle: source
      target: get_image
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: http_request
        targetType: http_request
      source: get_image
      sourceHandle: source
      target: upload_image
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        sourceType: http_request
        targetType: answer
      source: upload_image
      sourceHandle: source
      target: final_response
      targetHandle: target
      type: custom
    nodes:
    - data:
        type: start
        variables:
        - label: '请输入图片描述'
          required: true
          type: text-input
          variable: prompt
      height: 100
      id: start_node
      position:
        x: 100
        y: 100
      type: custom
      width: 200
    - data:
        config:
          body:
            "4":
              inputs:
                text: "{{input.prompt}}"
          headers:
            Content-Type: application/json
          method: POST
          timeout: 60
          url: http://localhost:8888/api/workflow/workflow-api
        type: http_request
      height: 100
      id: generate_image
      position:
        x: 400
        y: 100
      type: custom
      width: 200
    - data:
        config:
          method: GET
          retry:
            interval: 5
            max_attempts: 20
          success_conditions:
          - "{{response.status}} == 'completed'"
          timeout: 30
          url: "http://localhost:8888/api/task_status/{{generate_image.data.prompt_id}}"
        type: http_request
      height: 100
      id: check_status
      position:
        x: 700
        y: 100
      type: custom
      width: 200
    - data:
        config:
          method: GET
          timeout: 30
          url: "http://localhost:8888/api/history/{{generate_image.data.prompt_id}}/image"
        type: http_request
      height: 100
      id: get_image
      position:
        x: 1000
        y: 100
      type: custom
      width: 200
    - data:
        config:
          body:
            file: "{{get_image.data}}"
          headers:
            Authorization: "Bearer your-token"
          method: POST
          timeout: 120
          url: http://your-lsky-url/api/v1/upload
        type: http_request
      height: 100
      id: upload_image
      position:
        x: 1300
        y: 100
      type: custom
      width: 200
    - data:
        answer: |
          图片生成并上传成功！
          访问地址：{{upload_image.data.data.links.url}}
          
          生成参数：
          - Prompt: {{input.prompt}}
          - 任务ID: {{generate_image.data.prompt_id}}
        type: answer
      height: 100
      id: final_response
      position:
        x: 1600
        y: 100
      type: custom
      width: 200
    viewport:
      x: 0
      y: 0
      zoom: 1
